<!DOCTYPE html>
<html lang="it">
    <head>
        <title>Lista dei Gruppi</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

        <style type="text/css">
            body{
              background: rgb(54,217,182);
              background: linear-gradient(90deg, rgba(54,217,182,1) 0%, rgba(32,152,126,1) 43%, rgba(0,212,255,1) 100%);
            }
    
    
            h1, h2, h3, h4, h5, p, span, strike{
              font-family: 'Montserrat', sans-serif;
    
            }
    
    
            #groups-container{
              max-width:600px;
              margin:0 auto;
              box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
              background-color: #fff;
              
              margin-top:100px;
              margin-bottom:100px;
    
              justify-content: space-around;
              align-items: flex-start;
    
            }
    
            #form-wrapper{
              position: -webkit-sticky;
              position: sticky;
              top: 0rem;
              border-bottom: 1px solid  #e9e9e9;
              background-color: #fff;
              box-shadow: 0 3px 8px rgba(0,0,0,0.25);
               padding:40px;
            }
    
            #submit{
              background-color: #36d9b6;
              border-radius: 0;
              border:0;
              color: #fff;
            }
    
            .flex-wrapper{
                display: flex;
            }
    
            .task-wrapper{
                  margin:5px;
                  padding: 5px;
                  padding:20px;
                  cursor: pointer;
                  border-bottom: 1px solid  #e9e9e9;
                  color: #686868;
                }
    
        </style>
    </head>

    <body onload=" buildAuthorList();">
        {% include 'components/navbar.html'%}

        <div class="container">
            <div id="groups-container">
                <div id="form-wrapper">
                    <form id="form">
                        <div class="flex-wrapper">
                            <div style="flex: 6">
                                <input id="name" class="form-control" type="text" name="name" placeholder="Nome del Gruppo">
                                <textarea id="other-info" class="form-control" name="other-info" placeholder="Informazioni aggiuntive"  maxlength="200"></textarea>
                            </div>
                            <div style="flex: 1">
                                <input id="submit" class="btn" type="submit" >
                            </div>
                        </div>
                    </form>
                </div>
    
                <div id="group-wrapper">
                
                </div>	
            </div>
    
        </div>
    </body>
</html>

<script>

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    function buildAuthorList(){
        var wrapper = document.getElementById('group-wrapper');
        wrapper.innerHTML="";
        var url = "{% url 'api:group-list' %}";

        fetch(url)
        .then((resp) => resp.json())
        .then(function(data){
            console.log('Gruppi:', data);
       
            var lista = data;
            for(var i in lista){
                var item = `
                            <div id="group-${lista[i].id}" class="task-wrapper flex-wrapper">
                                <div style="flex:7">
                                    ${lista[i].name}
                                </div>
                                <div style="flex:2">
                                    <button class="btn btn-sm btn-outline-info edit">Modifica </button>
                                </div>
                                <div style="flex:2">
                                    <button class="btn btn-sm btn-outline-dark delete">-</button>
                                </div>
                            </div>
                        `;
                wrapper.innerHTML += item;
            }
        })
    }

    var form = document.getElementById('form-wrapper')
    form.addEventListener('submit', function(e){
        e.preventDefault()
        console.log('Form submitted')
        var url = '{% url 'api:group-create' %}'
        var name = document.getElementById('name').value
        var other_info = document.getElementById('other-info').value
        
        fetch(url, {
            method:'POST',
            headers:{
                'Content-type':'application/json',
                'X-CSRFToken':csrftoken,
            },
            body:JSON.stringify({
                                    "name":name,
                                    "other_info":other_info
                                })
        }
        ).then(function(response){
            buildAuthorList();
            document.getElementById('form').reset()
        })
    })
</script>